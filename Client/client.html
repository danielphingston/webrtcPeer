<!DOCTYPE html>
<html>
  <head>
    <title>Video Record</title>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  </head>
  <body>
    <div style="float: left">
      <video id="myVideo" autoplay="autoplay" height="400" width="500"></video>
      <button id="record">Record</button>
      <button id="download">Download</button>
    </div>
    <div style="float: left">
      <video id="player" autoplay="autoplay" height="400" width="500"></video>
      <button id="playBtn">play</button>
    </div>
  </body>
  <script type="text/javascript">
    const video = document.getElementById('myVideo');
    const player = document.getElementById('player');

    const options = {
      OfferToReceiveVideo: true
    };
    var pc = new RTCPeerConnection(options);

    var pc2 = new RTCPeerConnection(options);

    pc2.ontrack = function(e) {
      console.log('here');
    };

    let stream;

    //var myChannel = peerCon.createDataChannel('myChannel');
    pc.onicecandidate = function(e) {
      if (e.candidate !== null) pc2.addIceCandidate(e.candidate);
    };
    pc2.onicecandidate = function(e) {
      console.log(e);
      pc.addIceCandidate(e.candidate);
    };

    async function startCapture() {
      if (video.srcObject) {
        let tracks = video.srcObject.getTracks();

        tracks.forEach(track => track.stop());
        video.srcObject = null;

        //  download(new Blob(chunks), 'recording.webm');
      } else {
        try {
          stream = await navigator.mediaDevices.getDisplayMedia({
            video: true
          });
          video.srcObject = stream;
          pc.createOffer().then(offer => {
            pc.setLocalDescription(offer);
          });
        } catch (err) {
          console.log(err);
        }
      }
    }

    function play() {
      pc2
        .setRemoteDescription(pc.localDescription)
        .then(() => pc2.createAnswer())
        .then(answer => {
          pc2.setLocalDescription(answer);
        })
        .then(() => {
          pc.setRemoteDescription(pc2.localDescription);
        })
        .then(() => {
          stream.getTracks().forEach(track => pc.addTrack(track, stream));
        })
        .catch(e => console.log('Error: ' + e));
    }

    document.getElementById('record').addEventListener('click', startCapture);
    document.getElementById('download').addEventListener('click', play);
  </script>
</html>
